<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nghe v√† Vi·∫øt Ch√≠nh T·∫£: My First Sentences</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --primary-color: #ec407a;
            --primary-dark: #c2185b;
            --success-color: #4caf50;
            --error-color: #f44336;
            --light-bg: #fce4ec;
            --text-color: #333;
            --white-color: #ffffff;
            --yellow-color: #ffc107;
            --topic-color-1: #ef5350;
            --topic-color-2: #42a5f5;
            --topic-color-3: #66bb6a;
            --topic-color-4: #ffa726;
            --topic-color-5: #ab47bc;
            --topic-color-6: #78909c;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(120deg, #f8bbd0 0%, #ce93d8 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-color);
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }

        #root {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            text-align: center;
            padding: 25px;
            max-width: 900px;
            width: 95%;
            background: var(--white-color);
            border-radius: 24px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1), 0 4px 15px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
        }

        .game-title {
            font-size: clamp(1.8em, 5vw, 2.5em);
            color: var(--primary-color);
            margin: 0 0 5px;
            font-weight: 700;
        }

        .game-subtitle {
            font-size: clamp(1.2em, 4vw, 1.5em);
            margin-bottom: 20px;
            color: #555;
            font-weight: 600;
        }

        .meaning {
            font-size: clamp(1.1em, 4.5vw, 1.6em);
            color: var(--primary-dark);
            margin: 15px 0;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .input-container {
            position: relative;
            margin: 30px 0;
        }

        #answerInput,
        .text-input {
            width: 100%;
            padding: 15px 20px;
            font-size: clamp(1.1em, 4vw, 1.6em);
            font-family: 'Nunito', sans-serif;
            border-radius: 12px;
            border: 3px solid var(--primary-color);
            box-sizing: border-box;
            text-align: center;
            transition: all 0.3s ease;
        }

        #answerInput:focus,
        .text-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(236, 64, 122, 0.3);
        }

        #answerInput.correct {
            border-color: var(--success-color);
            background-color: #e8f5e9;
        }

        #answerInput.incorrect {
            border-color: var(--error-color);
            animation: shake 0.5s;
        }

        #hint {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: clamp(1.1em, 4vw, 1.6em);
            font-weight: 600;
            pointer-events: none;
            z-index: 10;
            width: max-content;
            max-width: 90%;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background: var(--primary-color);
            color: var(--white-color);
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-size: clamp(0.9em, 3.5vw, 1.1em);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover,
        button:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            outline: none;
        }

        button:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .score {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin-top: 20px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .message {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin: 15px 0;
            font-weight: 700;
            min-height: 25px;
            color: var(--error-color);
        }

        .start-screen,
        .topic-selection-screen,
        .topic-congrats-screen,
        .review-errors-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .main-btn,
        .topic-btn,
        .congrats-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 16px;
            width: 90%;
            max-width: 450px;
        }
        
        .topic-btn-container {
             display: flex;
             flex-direction: column;
             width: 100%;
             align-items: center;
             gap: 15px;
        }

        .main-btn { background-color: var(--success-color); }
        .main-btn:hover { background: #388e3c; }
        
        .topic-btn-color-1 { background-color: var(--topic-color-1); }
        .topic-btn-color-1:hover { background-color: #d32f2f; }
        .topic-btn-color-2 { background-color: var(--topic-color-2); }
        .topic-btn-color-2:hover { background-color: #1976d2; }
        .topic-btn-color-3 { background-color: var(--topic-color-3); }
        .topic-btn-color-3:hover { background-color: #388e3c; }
        .topic-btn-color-4 { background-color: var(--topic-color-4); }
        .topic-btn-color-4:hover { background-color: #f57c00; }
        .topic-btn-color-5 { background-color: var(--topic-color-5); }
        .topic-btn-color-5:hover { background-color: #8e24aa; }
        .topic-btn-color-6 { background-color: var(--topic-color-6); }
        .topic-btn-color-6:hover { background-color: #546e7a; }

        #playerNameInput {
            font-family: 'Nunito', sans-serif;
            font-size: 1.2em;
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            text-align: center;
            width: 80%;
            max-width: 300px;
        }

        .error-review-list {
            list-style-type: none;
            padding: 0;
            width: 100%;
            max-height: 40vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .error-review-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        .error-review-item:last-child {
            border-bottom: none;
        }
        .error-label {
            font-weight: 700;
            font-size: 0.9em;
        }
        .correct-answer {
            color: var(--success-color);
            word-break: break-all;
        }
        .user-answer {
            color: var(--error-color);
            word-break: break-all;
        }
        .error-char {
            color: #d32f2f;
            font-weight: bold;
            text-decoration: underline;
            background-color: #ffebee;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            button { padding: 10px 20px; }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const allSentences = [
            { en: "There are eight pictures in the classroom.", vi: "C√≥ t√°m b·ª©c tranh trong l·ªõp h·ªçc.", emoji: "üñºÔ∏è" },
            { en: "The book is under that chair.", vi: "Quy·ªÉn s√°ch ·ªü d∆∞·ªõi c√°i gh·∫ø ƒë√≥.", emoji: "üìñ" },
            { en: "This is a red crayon.", vi: "ƒê√¢y l√† m·ªôt c√¢y b√∫t s√°p m√†u ƒë·ªè.", emoji: "üñçÔ∏è" },
            { en: "What is your favourite drink? Lemonade.", vi: "ƒê·ªì u·ªëng y√™u th√≠ch c·ªßa b·∫°n l√† g√¨? N∆∞·ªõc chanh.", emoji: "üçã" },
            { en: "There are four people in my family.", vi: "Gia ƒë√¨nh t√¥i c√≥ b·ªën ng∆∞·ªùi.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "I have many books.", vi: "T√¥i c√≥ nhi·ªÅu s√°ch.", emoji: "üìö" },
            { en: "John learns to sing during Music lessons.", vi: "John h·ªçc h√°t trong gi·ªù h·ªçc √Çm nh·∫°c.", emoji: "üéµ" },
            { en: "Remember to drink water everyday. It‚Äôs good for our health.", vi: "H√£y nh·ªõ u·ªëng n∆∞·ªõc m·ªói ng√†y. N√≥ t·ªët cho s·ª©c kh·ªèe c·ªßa ch√∫ng ta.", emoji: "üíß" },
            { en: "What‚Äôs your hobby? I like playing hide-and-seek with my friends.", vi: "S·ªü th√≠ch c·ªßa b·∫°n l√† g√¨? T√¥i th√≠ch ch∆°i tr·ªën t√¨m v·ªõi b·∫°n b√®.", emoji: "üôà" },
            { en: "Is it Sunday today? No, it‚Äôs Saturday.", vi: "H√¥m nay l√† Ch·ªß nh·∫≠t ph·∫£i kh√¥ng? Kh√¥ng, h√¥m nay l√† Th·ª© B·∫£y.", emoji: "üìÖ" },
            { en: "This is John. He‚Äôs my brother.", vi: "ƒê√¢y l√† John. C·∫≠u ·∫•y l√† anh trai t√¥i.", emoji: "üë¶" },
            { en: "There are many books on the bookshelf.", vi: "C√≥ nhi·ªÅu s√°ch tr√™n gi√° s√°ch.", emoji: "üìö" },
            { en: "Please give me some more sugar.", vi: "L√†m ∆°n cho t√¥i th√™m m·ªôt √≠t ƒë∆∞·ªùng.", emoji: "üç¨" },
            { en: "How old is your brother?", vi: "Anh trai b·∫°n bao nhi√™u tu·ªïi?", emoji: "‚ùì" },
            { en: "It‚Äôs nice to meet you.", vi: "R·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n.", emoji: "üòä" },
            { en: "The name of my school is Greenfield Primary School.", vi: "T√™n tr∆∞·ªùng c·ªßa t√¥i l√† Tr∆∞·ªùng Ti·ªÉu h·ªçc Greenfield.", emoji: "üè´" },
            { en: "It‚Äôs a brown bear.", vi: "ƒê√≥ l√† m·ªôt con g·∫•u m√†u n√¢u.", emoji: "üêª" },
            { en: "Spiders hear by using hairs on their legs.", vi: "Nh·ªán nghe b·∫±ng c√°ch s·ª≠ d·ª•ng l√¥ng tr√™n ch√¢n c·ªßa ch√∫ng.", emoji: "üï∑Ô∏è" },
            { en: "Which month is your birthday? It‚Äôs in July.", vi: "Sinh nh·∫≠t c·ªßa b·∫°n v√†o th√°ng n√†o? V√†o th√°ng B·∫£y.", emoji: "üéÇ" },
            { en: "Let‚Äôs draw a picture of a cat.", vi: "Ch√∫ng ta h√£y v·∫Ω m·ªôt b·ª©c tranh v·ªÅ m·ªôt con m√®o.", emoji: "üé®" },
            { en: "How often do you have Science? I have it twice a week.", vi: "B·∫°n c√≥ th∆∞·ªùng xuy√™n h·ªçc m√¥n Khoa h·ªçc kh√¥ng? T√¥i h·ªçc n√≥ hai l·∫ßn m·ªôt tu·∫ßn.", emoji: "üß™" },
            { en: "We need some carrots for the dish.", vi: "Ch√∫ng ta c·∫ßn m·ªôt √≠t c√† r·ªët cho m√≥n ƒÉn.", emoji: "ü•ï" },
            { en: "When is the next Science class?", vi: "Khi n√†o c√≥ l·ªõp Khoa h·ªçc ti·∫øp theo?", emoji: "üî¨" },
            { en: "Do you know Phong‚Äôs date of birth?", vi: "B·∫°n c√≥ bi·∫øt ng√†y sinh c·ªßa Phong kh√¥ng?", emoji: "üéÇ" },
            { en: "Her school is in Sydney, Australia.", vi: "Tr∆∞·ªùng c·ªßa c√¥ ·∫•y ·ªü Sydney, √öc.", emoji: "üá¶üá∫" },
            { en: "How many robots are there? There are three robots.", vi: "C√≥ bao nhi√™u con robot? C√≥ ba con robot.", emoji: "ü§ñ" },
            { en: "My sister can speak French.", vi: "Ch·ªã g√°i t√¥i c√≥ th·ªÉ n√≥i ti·∫øng Ph√°p.", emoji: "üá´üá∑" },
            { en: "What a nice present!", vi: "M·ªôt m√≥n qu√† th·∫≠t ƒë·∫πp!", emoji: "üéÅ" },
            { en: "Sit down, please!", vi: "M·ªùi ng·ªìi!", emoji: "ü™ë" },
            { en: "I‚Äôm from Vietnam. How about you?", vi: "T√¥i ƒë·∫øn t·ª´ Vi·ªát Nam. C√≤n b·∫°n th√¨ sao?", emoji: "üáªüá≥" },
            { en: "What class is she in? She‚Äôs in class 4D.", vi: "C√¥ ·∫•y h·ªçc l·ªõp n√†o? C√¥ ·∫•y h·ªçc l·ªõp 4D.", emoji: "üè´" },
            { en: "It is Tuesday today.", vi: "H√¥m nay l√† th·ª© Ba.", emoji: "üìÖ" },
            { en: "My favourite subject is Music.", vi: "M√¥n h·ªçc y√™u th√≠ch c·ªßa t√¥i l√† √Çm nh·∫°c.", emoji: "üé∂" },
            { en: "I can speak English very well.", vi: "T√¥i c√≥ th·ªÉ n√≥i ti·∫øng Anh r·∫•t t·ªët.", emoji: "üá¨üáß" },
            { en: "Nam has ten pencils. Mai has four pencils. How many pencils do they have?", vi: "Nam c√≥ m∆∞·ªùi c√°i b√∫t ch√¨. Mai c√≥ b·ªën c√°i b√∫t ch√¨. H·ªç c√≥ bao nhi√™u c√°i b√∫t ch√¨?", emoji: "‚úèÔ∏è" },
            { en: "He would like some orange juice.", vi: "C·∫≠u ·∫•y mu·ªën m·ªôt √≠t n∆∞·ªõc cam.", emoji: "üçä" },
            { en: "She plays badminton on Tuesday.", vi: "C√¥ ·∫•y ch∆°i c·∫ßu l√¥ng v√†o th·ª© Ba.", emoji: "üè∏" },
            { en: "Mary likes reading. On his bookshelf, there are a lot of books.", vi: "Mary th√≠ch ƒë·ªçc s√°ch. Tr√™n gi√° s√°ch c·ªßa c√¥ ·∫•y, c√≥ r·∫•t nhi·ªÅu s√°ch.", emoji: "üìö" },
            { en: "We are from Japan. We are Japanese.", vi: "Ch√∫ng t√¥i ƒë·∫øn t·ª´ Nh·∫≠t B·∫£n. Ch√∫ng t√¥i l√† ng∆∞·ªùi Nh·∫≠t.", emoji: "üáØüáµ" },
            { en: "I would like a cake.", vi: "T√¥i mu·ªën m·ªôt c√°i b√°nh.", emoji: "üéÇ" },
            { en: "What subject do you like the most, Tommy? - I like English.", vi: "Tommy, b·∫°n th√≠ch m√¥n h·ªçc n√†o nh·∫•t? - T√¥i th√≠ch ti·∫øng Anh.", emoji: "üá¨üáß" },
            { en: "Happy birthday to you!", vi: "Ch√∫c m·ª´ng sinh nh·∫≠t b·∫°n!", emoji: "üéâ" },
            { en: "My favourite day is Thursday.", vi: "Ng√†y y√™u th√≠ch c·ªßa t√¥i l√† th·ª© NƒÉm.", emoji: "üìÖ" },
            { en: "The tenth month of a year is October.", vi: "Th√°ng th·ª© m∆∞·ªùi c·ªßa m·ªôt nƒÉm l√† th√°ng M∆∞·ªùi.", emoji: "üéÉ" },
            { en: "There are four cows on the field.", vi: "C√≥ b·ªën con b√≤ tr√™n c√°nh ƒë·ªìng.", emoji: "üêÑ" },
            { en: "I can talk with my mouth.", vi: "T√¥i c√≥ th·ªÉ n√≥i b·∫±ng mi·ªáng.", emoji: "üëÑ" },
            { en: "My family sat together and watched TV in the living room.", vi: "Gia ƒë√¨nh t√¥i ƒë√£ ng·ªìi c√πng nhau v√† xem TV trong ph√≤ng kh√°ch.", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { en: "Let‚Äôs play badminton.", vi: "Ch√∫ng ta h√£y ch∆°i c·∫ßu l√¥ng.", emoji: "üè∏" },
            { en: "That‚Äôs a good idea.", vi: "ƒê√≥ l√† m·ªôt √Ω ki·∫øn hay.", emoji: "üëç" },
            { en: "Peter has many rulers.", vi: "Peter c√≥ nhi·ªÅu c√¢y th∆∞·ªõc.", emoji: "üìè" },
            { en: "Today is November 21st.", vi: "H√¥m nay l√† ng√†y 21 th√°ng 11.", emoji: "üóìÔ∏è" },
            { en: "The birthday is on the twenty-sixth of March.", vi: "Sinh nh·∫≠t l√† v√†o ng√†y hai m∆∞∆°i s√°u th√°ng ba.", emoji: "üéÇ" },
            { en: "My school is in Hoang Hoa Tham Street.", vi: "Tr∆∞·ªùng t√¥i ·ªü tr√™n ƒë∆∞·ªùng Ho√†ng Hoa Th√°m.", emoji: "üè´" },
            { en: "I don't remember my sister's birthday.", vi: "T√¥i kh√¥ng nh·ªõ sinh nh·∫≠t c·ªßa ch·ªã g√°i t√¥i.", emoji: "ü§î" },
            { en: "The name of my school is Phuong Mai Primary School.", vi: "T√™n tr∆∞·ªùng c·ªßa t√¥i l√† Tr∆∞·ªùng Ti·ªÉu h·ªçc Ph∆∞∆°ng Mai.", emoji: "üè´" },
            { en: "Read the chant aloud.", vi: "ƒê·ªçc to b√†i ƒë·ªìng dao.", emoji: "üó£Ô∏è" },
            { en: "Linh is writing a letter to her pen friend.", vi: "Linh ƒëang vi·∫øt th∆∞ cho b·∫°n qua th∆∞ c·ªßa m√¨nh.", emoji: "‚úçÔ∏è" },
            { en: "How many hours are there in a day? There are 24 hours.", vi: "C√≥ bao nhi√™u gi·ªù trong m·ªôt ng√†y? C√≥ 24 gi·ªù.", emoji: "‚è∞" },
            { en: "He is my friend.", vi: "Anh ·∫•y l√† b·∫°n c·ªßa t√¥i.", emoji: "üßë‚Äçü§ù‚Äçüßë" },
            { en: "That notebook is blue.", vi: "Quy·ªÉn s·ªï ƒë√≥ m√†u xanh d∆∞∆°ng.", emoji: "üìì" },
            { en: "The flower is pink.", vi: "B√¥ng hoa m√†u h·ªìng.", emoji: "üå∏" },
            { en: "What did you do last weekend?", vi: "B·∫°n ƒë√£ l√†m g√¨ cu·ªëi tu·∫ßn tr∆∞·ªõc?", emoji: "‚ùì" },
            { en: "Do you like swimming?", vi: "B·∫°n c√≥ th√≠ch b∆°i kh√¥ng?", emoji: "üèä" },
            { en: "When do you have English?", vi: "Khi n√†o b·∫°n c√≥ m√¥n ti·∫øng Anh?", emoji: "üá¨üáß" },
            { en: "I can play the violin.", vi: "T√¥i c√≥ th·ªÉ ch∆°i violin.", emoji: "üéª" },
            { en: "There are many kites in the sky.", vi: "C√≥ nhi·ªÅu di·ªÅu tr√™n b·∫ßu tr·ªùi.", emoji: "ü™Å" },
            { en: "She always brushes her teeth before going to school.", vi: "C√¥ ·∫•y lu√¥n ƒë√°nh rƒÉng tr∆∞·ªõc khi ƒë·∫øn tr∆∞·ªùng.", emoji: "ü¶∑" },
            { en: "Listen to the teacher, please.", vi: "L√†m ∆°n l·∫Øng nghe gi√°o vi√™n.", emoji: "üëÇ" },
            { en: "The biggest bats are fruit bats.", vi: "Lo√†i d∆°i l·ªõn nh·∫•t l√† d∆°i ƒÉn qu·∫£.", emoji: "ü¶á" },
            { en: "Would you like an ice-cream?", vi: "B·∫°n c√≥ mu·ªën m·ªôt c√¢y kem kh√¥ng?", emoji: "üç¶" },
            { en: "When is your birthday?", vi: "Khi n√†o l√† sinh nh·∫≠t c·ªßa b·∫°n?", emoji: "üéÇ" },
            { en: "My school is in Bat Trang Village. It‚Äôs very big.", vi: "Tr∆∞·ªùng t√¥i ·ªü l√†ng B√°t Tr√†ng. N√≥ r·∫•t l·ªõn.", emoji: "üè´" },
            { en: "That is my bedroom.", vi: "ƒê√≥ l√† ph√≤ng ng·ªß c·ªßa t√¥i.", emoji: "üõå" },
            { en: "Would you like an ice cream? - No, thanks.", vi: "B·∫°n c√≥ mu·ªën ƒÉn kem kh√¥ng? - Kh√¥ng, c·∫£m ∆°n.", emoji: "üç¶" },
            { en: "Her house is very big.", vi: "Nh√† c·ªßa c√¥ ·∫•y r·∫•t l·ªõn.", emoji: "üè†" },
            { en: "We are having a break.", vi: "Ch√∫ng t√¥i ƒëang ngh·ªâ gi·∫£i lao.", emoji: "ü§∏" },
            { en: "How‚Äôs the weather in Hanoi today?", vi: "Th·ªùi ti·∫øt ·ªü H√† N·ªôi h√¥m nay th·∫ø n√†o?", emoji: "üå¶Ô∏è" },
            { en: "Can you give me a photo of you?", vi: "B·∫°n c√≥ th·ªÉ cho t√¥i m·ªôt t·∫•m ·∫£nh c·ªßa b·∫°n kh√¥ng?", emoji: "üì∑" },
            { en: "My father walks to work every day.", vi: "B·ªë t√¥i ƒëi b·ªô ƒëi l√†m m·ªói ng√†y.", emoji: "üö∂" },
            { en: "I have many birthday presents from my friends.", vi: "T√¥i c√≥ nhi·ªÅu qu√† sinh nh·∫≠t t·ª´ b·∫°n b√®.", emoji: "üéÅ" },
            { en: "I have a red kite.", vi: "T√¥i c√≥ m·ªôt con di·ªÅu m√†u ƒë·ªè.", emoji: "ü™Å" },
            { en: "How‚Äôs the weather in Hanoi?", vi: "Th·ªùi ti·∫øt ·ªü H√† N·ªôi th·∫ø n√†o?", emoji: "üå¶Ô∏è" },
            { en: "How much is that hat?", vi: "C√°i m≈© ƒë√≥ gi√° bao nhi√™u?", emoji: "üëí" },
            { en: "I like to play with a yo-yo.", vi: "T√¥i th√≠ch ch∆°i yo-yo.", emoji: "ü™Ä" },
            { en: "Which month is right after March? It‚Äôs April.", vi: "Th√°ng n√†o ngay sau th√°ng Ba? ƒê√≥ l√† th√°ng T∆∞.", emoji: "üìÖ" },
            { en: "Look at the timetable, please!", vi: "L√†m ∆°n nh√¨n v√†o th·ªùi kh√≥a bi·ªÉu!", emoji: "üóìÔ∏è" },
            { en: "What lesson are they having?", vi: "H·ªç ƒëang c√≥ ti·∫øt h·ªçc g√¨?", emoji: "üìö" },
            { en: "These are my rulers.", vi: "ƒê√¢y l√† nh·ªØng c√¢y th∆∞·ªõc c·ªßa t√¥i.", emoji: "üìè" },
            { en: "We are at home on Sundays.", vi: "Ch√∫ng t√¥i ·ªü nh√† v√†o c√°c ng√†y Ch·ªß nh·∫≠t.", emoji: "üè†" },
            { en: "Look at the board, please.", vi: "Xin h√£y nh√¨n l√™n b·∫£ng.", emoji: "Ïπ†Ìåê" },
            { en: "What is the date today? It‚Äôs April the seventh.", vi: "H√¥m nay l√† ng√†y m·∫•y? Ng√†y b·∫£y th√°ng t∆∞.", emoji: "üìÖ" },
            { en: "Tom is my friend too.", vi: "Tom c≈©ng l√† b·∫°n c·ªßa t√¥i.", emoji: "üßë‚Äçü§ù‚Äçüßë" },
            { en: "What time is it?", vi: "M·∫•y gi·ªù r·ªìi?", emoji: "‚è∞" },
            { en: "Let's go or we will be late for lunch.", vi: "Ch√∫ng ta ƒëi th√¥i n·∫øu kh√¥ng s·∫Ω tr·ªÖ b·ªØa tr∆∞a.", emoji: "üèÉ" },
            { en: "Linh doesn‚Äôt like playing the guitar.", vi: "Linh kh√¥ng th√≠ch ch∆°i ƒë√†n guitar.", emoji: "üé∏" },
            { en: "The pictures are on the wall.", vi: "Nh·ªØng b·ª©c tranh ·ªü tr√™n t∆∞·ªùng.", emoji: "üñºÔ∏è" },
            { en: "Is that your new school?", vi: "Kia c√≥ ph·∫£i tr∆∞·ªùng m·ªõi c·ªßa b·∫°n kh√¥ng?", emoji: "üè´" },
            { en: "Can you speak English? No, I can‚Äôt.", vi: "B·∫°n c√≥ th·ªÉ n√≥i ti·∫øng Anh kh√¥ng? Kh√¥ng, t√¥i kh√¥ng th·ªÉ.", emoji: "üó£Ô∏è" },
            { en: "Are you a student? Yes, I am.", vi: "B·∫°n c√≥ ph·∫£i l√† h·ªçc sinh kh√¥ng? V√¢ng, ph·∫£i.", emoji: "üßë‚Äçüéì" },
            { en: "Linh likes flying a kite in the afternoon.", vi: "Linh th√≠ch th·∫£ di·ªÅu v√†o bu·ªïi chi·ªÅu.", emoji: "ü™Å" },
            { en: "Can you sing a song?", vi: "B·∫°n c√≥ th·ªÉ h√°t m·ªôt b√†i h√°t kh√¥ng?", emoji: "üé§" },
            { en: "When is your birthday, Mai?", vi: "Khi n√†o l√† sinh nh·∫≠t c·ªßa b·∫°n, Mai?", emoji: "üéÇ" },
            { en: "This is my brother. His name is David.", vi: "ƒê√¢y l√† anh trai t√¥i. T√™n anh ·∫•y l√† David.", emoji: "üë¶" },
            { en: "I like to sing and dance.", vi: "T√¥i th√≠ch h√°t v√† nh·∫£y.", emoji: "üíÉ" },
            { en: "I LIKE RUNNING.", vi: "T√îI TH√çCH CH·∫†Y.", emoji: "üèÉ" },
            { en: "Why does she like Arts?", vi: "T·∫°i sao c√¥ ·∫•y th√≠ch m√¥n M·ªπ thu·∫≠t?", emoji: "üé®" },
            { en: "My mother can drive a car.", vi: "M·∫π t√¥i c√≥ th·ªÉ l√°i xe √¥ t√¥.", emoji: "üöó" },
            { en: "Nam plays the guitar with his friends on Fridays.", vi: "Nam ch∆°i guitar v·ªõi b·∫°n b√® v√†o c√°c ng√†y th·ª© S√°u.", emoji: "üé∏" },
            { en: "Would you like a candy? No, thanks.", vi: "B·∫°n c√≥ mu·ªën ƒÉn k·∫πo kh√¥ng? Kh√¥ng, c·∫£m ∆°n.", emoji: "üç¨" },
            { en: "Is your school small? Yes, it is.", vi: "Tr∆∞·ªùng c·ªßa b·∫°n c√≥ nh·ªè kh√¥ng? V√¢ng, nh·ªè.", emoji: "üè´" },
            { en: "When is your birthday?", vi: "Khi n√†o l√† sinh nh·∫≠t c·ªßa b·∫°n?", emoji: "üéÇ" },
            { en: "My birthday is on Christmas Day.", vi: "Sinh nh·∫≠t c·ªßa t√¥i v√†o ng√†y Gi√°ng sinh.", emoji: "üéÑ" },
            { en: "There are three books on the table.", vi: "C√≥ ba quy·ªÉn s√°ch tr√™n b√†n.", emoji: "üìö" },
            { en: "Jolly‚Äôs got blue eyes.", vi: "Jolly c√≥ ƒë√¥i m·∫Øt m√†u xanh.", emoji: "üëÄ" },
            { en: "Can you swim, Mary? Yes, I can.", vi: "B·∫°n c√≥ th·ªÉ b∆°i kh√¥ng, Mary? C√≥, t√¥i c√≥ th·ªÉ.", emoji: "üèä" },
            { en: "December is the last month of the year.", vi: "Th√°ng M∆∞·ªùi hai l√† th√°ng cu·ªëi c√πng c·ªßa nƒÉm.", emoji: "üóìÔ∏è" },
            { en: "Goodbye, Sam. See you later.", vi: "T·∫°m bi·ªát, Sam. H·∫πn g·∫∑p l·∫°i.", emoji: "üëã" },
            { en: "Would you like to come to the caf√© with me?", vi: "B·∫°n c√≥ mu·ªën ƒë·∫øn qu√°n c√† ph√™ v·ªõi t√¥i kh√¥ng?", emoji: "‚òï" },
            { en: "Is it a green kite? ‚Äì No, it isn‚Äôt.", vi: "ƒê√≥ c√≥ ph·∫£i l√† m·ªôt con di·ªÅu m√†u xanh l√° c√¢y kh√¥ng? - Kh√¥ng, kh√¥ng ph·∫£i.", emoji: "ü™Å" },
            { en: "Sally is making a paper boat.", vi: "Sally ƒëang l√†m m·ªôt chi·∫øc thuy·ªÅn gi·∫•y.", emoji: "‚õµ" },
            { en: "Today is the eleventh of October.", vi: "H√¥m nay l√† ng√†y m∆∞·ªùi m·ªôt th√°ng M∆∞·ªùi.", emoji: "üìÖ" },
            { en: "What is Lan‚Äôs hobby? She likes reading comics.", vi: "S·ªü th√≠ch c·ªßa Lan l√† g√¨? C√¥ ·∫•y th√≠ch ƒë·ªçc truy·ªán tranh.", emoji: "üìñ" },
            { en: "Your school bag is heavy.", vi: "C·∫∑p s√°ch c·ªßa b·∫°n n·∫∑ng.", emoji: "üéí" },
            { en: "They are having breakfast.", vi: "H·ªç ƒëang ƒÉn s√°ng.", emoji: "üç≥" },
            { en: "Come here, please.", vi: "L·∫°i ƒë√¢y, l√†m ∆°n.", emoji: "üëà" },
            { en: "What do you have in your school bag?", vi: "B·∫°n c√≥ g√¨ trong c·∫∑p s√°ch?", emoji: "üéí" },
            { en: "Look, listen and repeat.", vi: "Nh√¨n, nghe v√† l·∫∑p l·∫°i.", emoji: "üó£Ô∏è" },
            { en: "I‚Äôm from England. I can speak English.", vi: "T√¥i ƒë·∫øn t·ª´ Anh. T√¥i c√≥ th·ªÉ n√≥i ti·∫øng Anh.", emoji: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø" },
            { en: "My favourite subject is Art.", vi: "M√¥n h·ªçc y√™u th√≠ch c·ªßa t√¥i l√† M·ªπ thu·∫≠t.", emoji: "üé®" },
            { en: "What toys do you have? I have three teddy bears and one train.", vi: "B·∫°n c√≥ ƒë·ªì ch∆°i g√¨? T√¥i c√≥ ba con g·∫•u b√¥ng v√† m·ªôt ƒëo√†n t√†u.", emoji: "üß∏" },
            { en: "Happy birthday to you, Nam.", vi: "Ch√∫c m·ª´ng sinh nh·∫≠t b·∫°n, Nam.", emoji: "üéâ" },
            { en: "Do you have any sisters? Yes, I have two sisters.", vi: "B·∫°n c√≥ ch·ªã em g√°i n√†o kh√¥ng? C√≥, t√¥i c√≥ hai ng∆∞·ªùi.", emoji: "üë≠" },
            { en: "Mary studies Maths from 7 a.m to 8 a.m on Sunday.", vi: "Mary h·ªçc To√°n t·ª´ 7 gi·ªù s√°ng ƒë·∫øn 8 gi·ªù s√°ng Ch·ªß Nh·∫≠t.", emoji: "‚ûï" },
            { en: "Brian is getting dressed in his room.", vi: "Brian ƒëang m·∫∑c qu·∫ßn √°o trong ph√≤ng c·ªßa m√¨nh.", emoji: "üëï" },
            { en: "I like balloons and flowers very much.", vi: "T√¥i r·∫•t th√≠ch b√≥ng bay v√† hoa.", emoji: "üéà" },
            { en: "How‚Äôs the weather today? It‚Äôs hot today.", vi: "Th·ªùi ti·∫øt h√¥m nay th·∫ø n√†o? H√¥m nay tr·ªùi n√≥ng.", emoji: "‚òÄÔ∏è" },
            { en: "Does he have two daughters?", vi: "Anh ·∫•y c√≥ hai con g√°i ph·∫£i kh√¥ng?", emoji: "üë®‚Äçüëß‚Äçüëß" },
            { en: "My home town is Hanoi.", vi: "Qu√™ h∆∞∆°ng c·ªßa t√¥i l√† H√† N·ªôi.", emoji: "üáªüá≥" },
            { en: "She can sing and dance well.", vi: "C√¥ ·∫•y c√≥ th·ªÉ h√°t v√† nh·∫£y gi·ªèi.", emoji: "üíÉ" },
            { en: "He is writing a letter.", vi: "Anh ·∫•y ƒëang vi·∫øt m·ªôt l√° th∆∞.", emoji: "‚úçÔ∏è" },
            { en: "Who did you meet? Some famous musicians.", vi: "B·∫°n ƒë√£ g·∫∑p ai? M·ªôt v√†i nh·∫°c sƒ© n·ªïi ti·∫øng.", emoji: "üé∂" },
            { en: "Elsa is beautiful in her blue dress.", vi: "Elsa th·∫≠t ƒë·∫πp trong chi·∫øc v√°y m√†u xanh c·ªßa c√¥ ·∫•y.", emoji: "üëó" },
            { en: "What is your favourite subject?", vi: "M√¥n h·ªçc y√™u th√≠ch c·ªßa b·∫°n l√† g√¨?", emoji: "üìö" },
            { en: "There is an eraser on the desk.", vi: "C√≥ m·ªôt c·ª•c t·∫©y tr√™n b√†n.", emoji: "üßº" },
            { en: "Is that your eraser? No, it is not.", vi: "ƒê√≥ c√≥ ph·∫£i l√† c·ª•c t·∫©y c·ªßa b·∫°n kh√¥ng? Kh√¥ng, kh√¥ng ph·∫£i.", emoji: "üßº" },
            { en: "My little sister is watching ‚ÄúTom & Jerry‚Äù in the bedroom.", vi: "Em g√°i t√¥i ƒëang xem ‚ÄúTom & Jerry‚Äù trong ph√≤ng ng·ªß.", emoji: "üì∫" },
            { en: "Wow, you have a lot of interesting books.", vi: "Wow, b·∫°n c√≥ r·∫•t nhi·ªÅu s√°ch th√∫ v·ªã.", emoji: "üìö" },
            { en: "What day is it today? It‚Äôs Friday.", vi: "H√¥m nay l√† th·ª© m·∫•y? Th·ª© S√°u.", emoji: "üìÖ" },
            { en: "What subjects do you have today? Today I have Music and Maths.", vi: "H√¥m nay b·∫°n c√≥ nh·ªØng m√¥n h·ªçc n√†o? H√¥m nay t√¥i c√≥ √Çm nh·∫°c v√† To√°n.", emoji: "üé∂" },
            { en: "My parents took me to the zoo last weekend.", vi: "B·ªë m·∫π t√¥i ƒë√£ ƒë∆∞a t√¥i ƒë·∫øn s·ªü th√∫ cu·ªëi tu·∫ßn tr∆∞·ªõc.", emoji: "ü¶ì" },
            { en: "He‚Äôs in London.", vi: "Anh ·∫•y ·ªü London.", emoji: "üá¨üáß" },
            { en: "A fish can swim but it can‚Äôt walk.", vi: "M·ªôt con c√° c√≥ th·ªÉ b∆°i nh∆∞ng kh√¥ng th·ªÉ ƒëi b·ªô.", emoji: "üêü" },
            { en: "Welcome to my house. Come in.", vi: "Ch√†o m·ª´ng ƒë·∫øn nh√† t√¥i. M·ªùi v√†o.", emoji: "üè†" },
            { en: "I brush my teeth in the morning.", vi: "T√¥i ƒë√°nh rƒÉng v√†o bu·ªïi s√°ng.", emoji: "ü¶∑" },
            { en: "There are four rooms in my house.", vi: "Nh√† t√¥i c√≥ b·ªën ph√≤ng.", emoji: "üè†" },
            { en: "His car is white.", vi: "Xe c·ªßa anh ·∫•y m√†u tr·∫Øng.", emoji: "üöó" },
            { en: "When is your brother‚Äôs birthday? It‚Äôs in July.", vi: "Sinh nh·∫≠t c·ªßa anh trai b·∫°n khi n√†o? V√†o th√°ng B·∫£y.", emoji: "üéÇ" },
            { en: "His sister is tall but he is short.", vi: "Ch·ªã g√°i c·ªßa anh ·∫•y cao nh∆∞ng anh ·∫•y th·∫•p.", emoji: "üìè" },
            { en: "Who is she? She is my teacher.", vi: "C√¥ ·∫•y l√† ai? C√¥ ·∫•y l√† gi√°o vi√™n c·ªßa t√¥i.", emoji: "üë©‚Äçüè´" },
            { en: "Read aloud and then sit down.", vi: "ƒê·ªçc to r·ªìi ng·ªìi xu·ªëng.", emoji: "üó£Ô∏è" },
            { en: "Mai and Lam are reading a comic book in the classroom.", vi: "Mai v√† Lam ƒëang ƒë·ªçc truy·ªán tranh trong l·ªõp h·ªçc.", emoji: "üìñ" },
            { en: "She tells her friend to come to her house at 7 o‚Äôclock on Sunday.", vi: "C√¥ ·∫•y b·∫£o b·∫°n m√¨nh ƒë·∫øn nh√† c√¥ ·∫•y v√†o l√∫c 7 gi·ªù Ch·ªß Nh·∫≠t.", emoji: "‚è∞" },
            { en: "An anaconda is a snake.", vi: "TrƒÉn anaconda l√† m·ªôt lo√†i r·∫Øn.", emoji: "üêç" },
            { en: "Mai‚Äôs sister is playing volleyball with her friends.", vi: "Ch·ªã c·ªßa Mai ƒëang ch∆°i b√≥ng chuy·ªÅn v·ªõi b·∫°n b√®.", emoji: "üèê" },
            { en: "Would you like some milk?", vi: "B·∫°n c√≥ mu·ªën u·ªëng s·ªØa kh√¥ng?", emoji: "ü•õ" },
            { en: "It is rainy in Hanoi today.", vi: "H√¥m nay tr·ªùi m∆∞a ·ªü H√† N·ªôi.", emoji: "üåßÔ∏è" },
            { en: "Last weekend, we played volleyball on the beach.", vi: "Cu·ªëi tu·∫ßn tr∆∞·ªõc, ch√∫ng t√¥i ƒë√£ ch∆°i b√≥ng chuy·ªÅn tr√™n b√£i bi·ªÉn.", emoji: "üèê" },
            { en: "Let‚Äôs listen to some music.", vi: "Ch√∫ng ta h√£y nghe nh·∫°c.", emoji: "üéß" },
            { en: "She works in a small school.", vi: "C√¥ ·∫•y l√†m vi·ªác trong m·ªôt ng√¥i tr∆∞·ªùng nh·ªè.", emoji: "üè´" },
            { en: "This flower vase is beautiful.", vi: "B√¨nh hoa n√†y ƒë·∫πp.", emoji: "üíê" },
            { en: "What‚Äôs the weather like today?", vi: "Th·ªùi ti·∫øt h√¥m nay th·∫ø n√†o?", emoji: "üå¶Ô∏è" },
            { en: "Oh, no! I don‚Äôt have any potato chips.", vi: "√îi, kh√¥ng! T√¥i kh√¥ng c√≥ khoai t√¢y chi√™n.", emoji: "ü•î" },
            { en: "Ha can dance but cannot play football.", vi: "H√† c√≥ th·ªÉ nh·∫£y nh∆∞ng kh√¥ng th·ªÉ ch∆°i b√≥ng ƒë√°.", emoji: "üíÉ" },
            { en: "September is the ninth month of the year.", vi: "Th√°ng Ch√≠n l√† th√°ng th·ª© ch√≠n c·ªßa nƒÉm.", emoji: "üóìÔ∏è" },
            { en: "My toys are in that box.", vi: "ƒê·ªì ch∆°i c·ªßa t√¥i ·ªü trong h·ªôp ƒë√≥.", emoji: "üß∏" },
            { en: "Do you want some grapes?", vi: "B·∫°n c√≥ mu·ªën ƒÉn nho kh√¥ng?", emoji: "üçá" },
            { en: "How many televisions are there in your house? Only one.", vi: "Nh√† b·∫°n c√≥ bao nhi√™u c√°i tivi? Ch·ªâ c√≥ m·ªôt.", emoji: "üì∫" },
            { en: "Give me a packet of milk, please.", vi: "L√†m ∆°n cho t√¥i m·ªôt h·ªôp s·ªØa.", emoji: "ü•õ" },
            { en: "I LIKE MUSIC.", vi: "T√îI TH√çCH √ÇM NH·∫†C.", emoji: "üéµ" },
            { en: "My sister is playing with the teddy bear.", vi: "Em g√°i t√¥i ƒëang ch∆°i v·ªõi g·∫•u b√¥ng.", emoji: "üß∏" }
        ];

        function createTopics(sentences, chunkSize) {
            const shuffled = [...sentences].sort(() => Math.random() - 0.5);
            const topics = {};
            let topicIndex = 1;
            for (let i = 0; i < shuffled.length; i += chunkSize) {
                const chunk = shuffled.slice(i, i + chunkSize);
                topics[`Ch·ªß ƒë·ªÅ ${topicIndex}`] = chunk;
                topicIndex++;
            }
            return topics;
        }

        const topics = createTopics(allSentences, 52);
        
        const GameState = {
            START: 'start',
            TOPIC_SELECTION: 'topicSelection',
            GAME: 'game',
            CONGRATS: 'congrats',
            REVIEW_ERRORS: 'review',
        };

        function useSpeechSynthesis() {
            const [isSpeaking, setIsSpeaking] = useState(false);
            const synth = window.speechSynthesis;

            const speak = useCallback((text, options = {}) => {
                if (!synth) return;

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = options.rate || 0.9;
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => {
                    setIsSpeaking(false);
                    if (options.onEnd) options.onEnd();
                };
                utterance.onerror = () => {
                     setIsSpeaking(false);
                };

                // H·ªßy b·ªè l·ªùi n√≥i hi·ªán t·∫°i tr∆∞·ªõc khi n√≥i l·ªùi m·ªõi
                if (synth.speaking) {
                    synth.cancel();
                }

                setTimeout(() => synth.speak(utterance), 100);

            }, [synth]);

            const cancel = useCallback(() => {
                if (synth) {
                    synth.cancel();
                    setIsSpeaking(false);
                }
            }, [synth]);

            useEffect(() => {
                return () => cancel();
            }, [cancel]);

            return { isSpeaking, speak, cancel };
        }

        function Fireworks() {
            const canvasRef = useRef(null);
            const animationFrameId = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let width = canvas.width = window.innerWidth;
                let height = canvas.height = window.innerHeight;
                let fireworks = [];
                let particles = [];
                let hue = 120;

                function random(min, max) { return Math.random() * (max - min) + min; }

                function Firework(sx, sy, tx, ty) {
                    this.x = sx; this.y = sy; this.sx = sx; this.sy = sy;
                    this.tx = tx; this.ty = ty;
                    this.distanceToTarget = Math.sqrt(Math.pow(tx - sx, 2) + Math.pow(ty - sy, 2));
                    this.distanceTraveled = 0;
                    this.coordinates = [];
                    this.coordinateCount = 3;
                    while (this.coordinateCount--) {
                        this.coordinates.push([this.x, this.y]);
                    }
                    this.angle = Math.atan2(ty - sy, tx - sx);
                    this.speed = 2;
                    this.acceleration = 1.05;
                    this.brightness = random(50, 70);
                    this.targetRadius = 1;
                }

                Firework.prototype.update = function (index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.acceleration;
                    const vx = Math.cos(this.angle) * this.speed;
                    const vy = Math.sin(this.angle) * this.speed;
                    this.distanceTraveled = Math.sqrt(Math.pow(this.x + vx - this.sx, 2) + Math.pow(this.y + vy - this.sy, 2));
                    if (this.distanceTraveled >= this.distanceToTarget) {
                        fireworks.splice(index, 1);
                        for (let i = 0; i < 30; i++) {
                            particles.push(new Particle(this.tx, this.ty));
                        }
                    } else {
                        this.x += vx;
                        this.y += vy;
                    }
                };

                Firework.prototype.draw = function () {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsl(${hue}, 100%, ${this.brightness}%)`;
                    ctx.stroke();
                };

                function Particle(x, y) {
                    this.x = x; this.y = y;
                    this.coordinates = [];
                    this.coordinateCount = 5;
                    while (this.coordinateCount--) {
                        this.coordinates.push([this.x, this.y]);
                    }
                    this.angle = random(0, Math.PI * 2);
                    this.speed = random(1, 10);
                    this.friction = 0.95;
                    this.gravity = 1;
                    this.hue = random(hue - 20, hue + 20);
                    this.brightness = random(50, 80);
                    this.alpha = 1;
                    this.decay = random(0.015, 0.03);
                }

                Particle.prototype.update = function (index) {
                    this.coordinates.pop();
                    this.coordinates.unshift([this.x, this.y]);
                    this.speed *= this.friction;
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed + this.gravity;
                    this.alpha -= this.decay;
                    if (this.alpha <= this.decay) {
                        particles.splice(index, 1);
                    }
                };

                Particle.prototype.draw = function () {
                    ctx.beginPath();
                    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                    ctx.lineTo(this.x, this.y);
                    ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                    ctx.stroke();
                };

                function loop() {
                    animationFrameId.current = requestAnimationFrame(loop);
                    hue += 0.5;
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, width, height);
                    ctx.globalCompositeOperation = 'lighter';
                    if (Math.random() < 0.05) {
                        fireworks.push(new Firework(width / 2, height, random(0, width), random(0, height / 2)));
                    }
                    fireworks.forEach((f, i) => { f.update(i); f.draw(); });
                    particles.forEach((p, i) => { p.update(i); p.draw(); });
                }

                const handleResize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);
                loop();

                return () => {
                    cancelAnimationFrame(animationFrameId.current);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            return <canvas ref={canvasRef}></canvas>;
        }

        function StartScreen({ onStart }) {
            const [playerName, setPlayerName] = useState('');
            const [error, setError] = useState('');

            const handleStart = () => {
                if (playerName.trim()) {
                    onStart(playerName.trim());
                } else {
                    setError('Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!');
                    setTimeout(() => setError(''), 3000);
                }
            };

            return (
                <div className="start-screen">
                    <input
                        type="text"
                        id="playerNameInput"
                        className="text-input"
                        placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..."
                        value={playerName}
                        onChange={(e) => setPlayerName(e.target.value)}
                        onKeyDown={(e) => e.key === 'Enter' && handleStart()}
                    />
                    <button id="startBtn" className="main-btn" onClick={handleStart}>B·∫Øt ƒë·∫ßu</button>
                    {error && <div className="message">{error}</div>}
                </div>
            );
        }

        function TopicSelectionScreen({ onSelectTopic }) {
            return (
                <div className="topic-selection-screen">
                    <div className="game-subtitle">Ch·ªçn m·ªôt ch·ªß ƒë·ªÅ ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                    <div className="topic-btn-container">
                        {Object.keys(topics).map((topic, index) => (
                            <button
                                key={topic}
                                className={`topic-btn topic-btn-color-${(index % 6) + 1}`}
                                onClick={() => onSelectTopic(topic)}
                            >
                                {`${topic} (${topics[topic].length} c√¢u)`}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }
        
        function ReviewErrorsScreen({ errors, onSelectTopic }) {
            const renderDiff = (correct, user) => {
                const diff = [];
                const maxLength = Math.max(correct.length, user.length);
                for(let i = 0; i < maxLength; i++) {
                    if (correct[i] !== user[i]) {
                         diff.push(<span key={i} className="error-char">{user[i] || ''}</span>);
                    } else {
                         diff.push(<span key={i}>{user[i]}</span>);
                    }
                }
                return diff;
            };

            return (
                <div className="review-errors-screen">
                     <div className="game-subtitle">Xem l·∫°i c√°c c√¢u tr·∫£ l·ªùi sai</div>
                     <ul className="error-review-list">
                        {errors.map((error, index) => (
                            <li key={index} className="error-review-item">
                                <div className="error-label">ƒê√°p √°n ƒë√∫ng:</div>
                                <p className="correct-answer">{error.correctAnswer}</p>
                                <div className="error-label">C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:</div>
                                <p className="user-answer">{renderDiff(error.correctAnswer, error.userAnswer)}</p>
                            </li>
                        ))}
                     </ul>
                     <button className="congrats-btn" style={{backgroundColor: 'var(--primary-color)'}} onClick={onSelectTopic}>
                        Ch·ªçn ch·ªß ƒë·ªÅ kh√°c
                     </button>
                </div>
            );
        }

        function CongratsScreen({ score, total, correctCount, playerName, topic, onPlayAgain, onSelectTopic, onReviewErrors, errors }) {
            return (
                <div className="topic-congrats-screen">
                    <div className="message" style={{ color: 'var(--success-color)', fontSize: '1.5em', lineHeight: '1.4' }}>
                        Ch√∫c m·ª´ng <strong>{playerName}</strong>!<br />
                        B·∫°n ƒë√£ ƒë·∫°t {score} ƒëi·ªÉm, ho√†n th√†nh ƒë√∫ng {correctCount}/{total} c√¢u trong "{topic}".
                    </div>
                    {errors.length > 0 && (
                         <button className="congrats-btn" style={{backgroundColor: 'var(--yellow-color)', color: 'var(--text-color)'}} onClick={onReviewErrors}>
                            Xem l·∫°i l·ªói sai ({errors.length})
                         </button>
                    )}
                    <button className="congrats-btn" style={{backgroundColor: 'var(--success-color)'}} onClick={onPlayAgain}>Ch∆°i l·∫°i ch·ªß ƒë·ªÅ n√†y</button>
                    <button className="congrats-btn" style={{backgroundColor: 'var(--primary-dark)'}} onClick={onSelectTopic}>Ch·ªçn ch·ªß ƒë·ªÅ kh√°c</button>
                    <Fireworks />
                </div>
            );
        }

        function GameScreen({ sentences, onGameEnd, onBackToTopics, topicName }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [completed, setCompleted] = useState(0);
            const [correctCount, setCorrectCount] = useState(0);
            const [mistakeCount, setMistakeCount] = useState(0);
            const [userAnswer, setUserAnswer] = useState('');
            const [message, setMessage] = useState('');
            const [messageColor, setMessageColor] = useState('var(--error-color)');
            const [isCorrect, setIsCorrect] = useState(null);
            const [isLocked, setIsLocked] = useState(false);
            const [errors, setErrors] = useState([]);
            
            const { isSpeaking, speak, cancel } = useSpeechSynthesis();
            const inputRef = useRef(null);
            const nextSentenceTimeoutRef = useRef(null);

            const currentSentence = sentences[currentIndex];

            const startNewSentence = useCallback((index) => {
                cancel();
                if (nextSentenceTimeoutRef.current) clearTimeout(nextSentenceTimeoutRef.current);

                if (index >= sentences.length) {
                    onGameEnd({ score, completed, correctCount, errors });
                    return;
                }
                
                setCurrentIndex(index);
                setUserAnswer('');
                setMistakeCount(0);
                setMessage('');
                setIsCorrect(null);
                setIsLocked(false);
                inputRef.current?.focus();
                
                const sentenceToSpeak = sentences[index].en;
                // Play twice
                speak(sentenceToSpeak, { onEnd: () => {
                    if (!isSpeaking) { // Avoid re-speaking if interrupted
                         speak(sentenceToSpeak);
                    }
                }});

            }, [sentences, onGameEnd, score, completed, correctCount, errors, cancel, speak, isSpeaking]);
            
            useEffect(() => {
                startNewSentence(0);
                return () => {
                    cancel();
                    if (nextSentenceTimeoutRef.current) clearTimeout(nextSentenceTimeoutRef.current);
                };
            }, [sentences]); // Only re-run when sentences array changes (i.e., new topic)

            const handleCheckAnswer = () => {
                if (isLocked) return;
                
                const cleanedUserAnswer = userAnswer.trim();
                const correctAnswer = currentSentence.en;

                if (cleanedUserAnswer === correctAnswer) {
                    setIsCorrect(true);
                    setIsLocked(true);
                    setMessage('Ch√≠nh x√°c! +10 ƒëi·ªÉm.');
                    setMessageColor('var(--success-color)');
                    setScore(prev => prev + 10);
                    setCorrectCount(prev => prev + 1);
                    setCompleted(prev => prev + 1);
                    cancel();
                    speak(correctAnswer, { onEnd: () => {
                        nextSentenceTimeoutRef.current = setTimeout(() => startNewSentence(currentIndex + 1), 2000);
                    }});
                } else {
                    const newMistakeCount = mistakeCount + 1;
                    setMistakeCount(newMistakeCount);
                    setIsCorrect(false);
                    
                    if (newMistakeCount >= 3) {
                        setIsLocked(true);
                        setMessage(`B·∫°n ƒë√£ sai 3 l·∫ßn. ƒê√°p √°n: "${correctAnswer}"`);
                        setErrors(prev => [...prev, { correctAnswer, userAnswer: cleanedUserAnswer }]);
                        setCompleted(prev => prev + 1);
                        cancel();
                        nextSentenceTimeoutRef.current = setTimeout(() => startNewSentence(currentIndex + 1), 3500);
                    } else {
                        setMessage(`Sai r·ªìi! (S·ªë l·∫ßn sai: ${newMistakeCount}/3)`);
                        setTimeout(() => setIsCorrect(null), 500);
                    }
                }
            };
            
            const handleListenAgain = () => {
                if (!isSpeaking) {
                    speak(currentSentence.en);
                }
            };

            const hintRef = useRef(null);

            const showHint = () => {
                if(hintRef.current) hintRef.current.style.display = 'block';
            };
            const hideHint = () => {
                if(hintRef.current) hintRef.current.style.display = 'none';
            };


            if (!currentSentence) return <div>ƒêang t·∫£i...</div>;

            return (
                <div className="game-screen">
                    <div className="game-subtitle">Ch·ªß ƒë·ªÅ: {topicName}</div>
                    <div className="meaning">
                        <span>&ldquo;{currentSentence.vi}&rdquo;</span>
                        <span>{currentSentence.emoji}</span>
                    </div>
                    <div className="input-container">
                        <input
                            ref={inputRef}
                            type="text"
                            id="answerInput"
                            placeholder="Nh·∫≠p c√¢u b·∫°n nghe ƒë∆∞·ª£c..."
                            autoComplete="off"
                            autoCorrect="off"
                            autoCapitalize="off"
                            spellCheck="false"
                            value={userAnswer}
                            onChange={(e) => setUserAnswer(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCheckAnswer()}
                            disabled={isLocked}
                            className={`${isCorrect === true ? 'correct' : ''} ${isCorrect === false ? 'incorrect' : ''}`}
                        />
                        <div id="hint" ref={hintRef}>{currentSentence.en}</div>
                    </div>
                    <div className="message" style={{ color: messageColor }}>{message}</div>
                    <div className="buttons">
                        <button id="listenAgainBtn" onClick={handleListenAgain} disabled={isSpeaking || isLocked}>Nghe l·∫°i</button>
                        <button id="checkBtn" onClick={handleCheckAnswer} disabled={isLocked}>Ki·ªÉm tra</button>
                         <button 
                            id="hintBtn" 
                            disabled={isLocked}
                            onMouseDown={showHint}
                            onMouseUp={hideHint}
                            onMouseLeave={hideHint}
                            onTouchStart={(e) => { e.preventDefault(); showHint(); }}
                            onTouchEnd={hideHint}
                            style={{backgroundColor: 'var(--yellow-color)', color: 'var(--text-color)'}}
                        >
                            G·ª£i √Ω
                        </button>
                        <button id="resetBtn" onClick={onBackToTopics} style={{backgroundColor: '#757575'}}>Ch·ªß ƒë·ªÅ kh√°c</button>
                    </div>
                    <div className="score">ƒêi·ªÉm: {score} | Ho√†n th√†nh: {completed}/{sentences.length}</div>
                </div>
            );
        }

        function App() {
            const [gameState, setGameState] = useState(GameState.START);
            const [playerName, setPlayerName] = useState('');
            const [currentTopic, setCurrentTopic] = useState(null);
            const [gameResult, setGameResult] = useState({ score: 0, total: 0, correctCount: 0, errors: [] });
            
            const { cancel: cancelSpeech } = useSpeechSynthesis();

            const handleStart = (name) => {
                setPlayerName(name);
                setGameState(GameState.TOPIC_SELECTION);
            };

            const handleSelectTopic = (topic) => {
                setCurrentTopic(topic);
                setGameState(GameState.GAME);
            };
            
            const handleBackToTopics = () => {
                cancelSpeech();
                setGameState(GameState.TOPIC_SELECTION);
            };

            const handleGameEnd = (result) => {
                setGameResult({
                     score: result.score, 
                     total: topics[currentTopic].length,
                     correctCount: result.correctCount,
                     errors: result.errors
                });
                setGameState(GameState.CONGRATS);
            };
            
            const handlePlayAgain = () => {
                setGameState(GameState.GAME);
            };
            
            const handleReviewErrors = () => {
                setGameState(GameState.REVIEW_ERRORS);
            };

            const renderScreen = () => {
                switch (gameState) {
                    case GameState.START:
                        return <StartScreen onStart={handleStart} />;
                    case GameState.TOPIC_SELECTION:
                        return <TopicSelectionScreen onSelectTopic={handleSelectTopic} />;
                    case GameState.GAME:
                        return <GameScreen 
                                    sentences={topics[currentTopic]}
                                    topicName={currentTopic} 
                                    onGameEnd={handleGameEnd} 
                                    onBackToTopics={handleBackToTopics} 
                                />;
                    case GameState.CONGRATS:
                        return <CongratsScreen 
                                    {...gameResult} 
                                    playerName={playerName} 
                                    topic={currentTopic}
                                    onPlayAgain={handlePlayAgain}
                                    onSelectTopic={handleBackToTopics}
                                    onReviewErrors={handleReviewErrors}
                                />;
                    case GameState.REVIEW_ERRORS:
                        return <ReviewErrorsScreen 
                                    errors={gameResult.errors} 
                                    onSelectTopic={handleBackToTopics}
                               />
                    default:
                        return <StartScreen onStart={handleStart} />;
                }
            };

            return (
                <div className="container">
                    <div className="game-title">NGHE V√Ä VI·∫æT CH√çNH T·∫¢</div>
                    {renderScreen()}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>
